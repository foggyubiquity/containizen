name: master
on:
  # check_suite:
  #   types: [ 'completed' ]
  push:
    branches:
      - master
  schedule:
    - cron: '15 2 * * *'

jobs:
  makisu:
    name: nixMakisu
    runs-on: ubuntu-latest
    steps:
      - run: docker login -u $DOCKER_USERNAME -p $DOCKER_PASSWORD
        if: github.actor != 'nektos/act'
        env:
          DOCKER_USERNAME: ${{ secrets.DOCKER_USERNAME }}
          DOCKER_PASSWORD: ${{ secrets.DOCKER_PASSWORD }}
      - uses: actions/checkout@v3
        with:
          fetch-depth: 1
      - run: docker build -t foggyubiquity/containizen:makisu .
      - run: docker push foggyubiquity/containizen:makisu
        if: github.actor != 'nektos/act'

  OCI-java:
    uses: ./.github/workflows/common-oci.yaml
    with:
      language: '[ "java" ]'
      version: '[ 8, 11 ]'
      pkgManager: '[ "none" ]'
      include: '[{"rolling": true, "version": 11}]'
    secrets: inherit
  OCI-nodejs:
    uses: ./.github/workflows/common-oci.yaml
    with:
      language: '[ "nodejs" ]'
      version: '[ 10, 12 ]'
      pkgManager: '[ "none", "bundled" ]'
      include: '[{"rolling": true, "version": 10}, {"language": "nodejs", "pkgManager": "bundled", "pkgManagerName": "-npm"}]'
    secrets: inherit
  OCI-python:
    uses: ./.github/workflows/common-oci.yaml
    with:
      language: '[ "python" ]'
      version: '[ 38 ]'
      pkgManager: '[ "none" ]'
      include: '[{"rolling": true, "version": 38}]'
    secrets: inherit

